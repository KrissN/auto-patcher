diff -Npruw stock-core/smali/java/lang/PrivacyInputStream.smali pdroid-core/smali/java/lang/PrivacyInputStream.smali
--- stock-core/smali/java/lang/PrivacyInputStream.smali	1969-12-31 18:00:00.000000000 -0600
+++ pdroid-core/smali/java/lang/PrivacyInputStream.smali	2014-01-25 12:10:19.870070163 -0600
@@ -0,0 +1,71 @@
+.class public Ljava/lang/PrivacyInputStream;
+.super Ljava/io/InputStream;
+.source "PrivacyInputStream.java"
+
+
+# direct methods
+.method public constructor <init>()V
+    .registers 1
+
+    invoke-direct {p0}, Ljava/io/InputStream;-><init>()V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public close()V
+    .registers 1
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/IOException;
+        }
+    .end annotation
+
+    invoke-super {p0}, Ljava/io/InputStream;->close()V
+
+    return-void
+.end method
+
+.method public read()I
+    .registers 2
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/IOException;
+        }
+    .end annotation
+
+    const/4 v0, -0x1
+
+    return v0
+.end method
+
+.method public read([B)I
+    .registers 3
+    .param p1    # [B
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/IOException;
+        }
+    .end annotation
+
+    const/4 v0, -0x1
+
+    return v0
+.end method
+
+.method public read([BII)I
+    .registers 5
+    .param p1    # [B
+    .param p2    # I
+    .param p3    # I
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/IOException;
+        }
+    .end annotation
+
+    const/4 v0, -0x1
+
+    return v0
+.end method
diff -Npruw stock-core/smali/java/lang/PrivacyProcessManager$PrivacyFileReader.smali pdroid-core/smali/java/lang/PrivacyProcessManager$PrivacyFileReader.smali
--- stock-core/smali/java/lang/PrivacyProcessManager$PrivacyFileReader.smali	1969-12-31 18:00:00.000000000 -0600
+++ pdroid-core/smali/java/lang/PrivacyProcessManager$PrivacyFileReader.smali	2014-01-25 12:10:19.874070163 -0600
@@ -0,0 +1,92 @@
+.class public Ljava/lang/PrivacyProcessManager$PrivacyFileReader;
+.super Ljava/lang/Object;
+.source "PrivacyProcessManager.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingClass;
+    value = Ljava/lang/PrivacyProcessManager;
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x9
+    name = "PrivacyFileReader"
+.end annotation
+
+
+# instance fields
+.field private buffReader:Ljava/io/BufferedReader;
+
+.field private inputStream:Ljava/io/FileInputStream;
+
+
+# direct methods
+.method public constructor <init>(Ljava/lang/String;)V
+    .registers 5
+    .param p1    # Ljava/lang/String;
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/FileNotFoundException;
+        }
+    .end annotation
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    new-instance v0, Ljava/io/FileInputStream;
+
+    new-instance v1, Ljava/io/File;
+
+    invoke-direct {v1, p1}, Ljava/io/File;-><init>(Ljava/lang/String;)V
+
+    invoke-direct {v0, v1}, Ljava/io/FileInputStream;-><init>(Ljava/io/File;)V
+
+    iput-object v0, p0, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->inputStream:Ljava/io/FileInputStream;
+
+    new-instance v0, Ljava/io/BufferedReader;
+
+    new-instance v1, Ljava/io/InputStreamReader;
+
+    iget-object v2, p0, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->inputStream:Ljava/io/FileInputStream;
+
+    invoke-direct {v1, v2}, Ljava/io/InputStreamReader;-><init>(Ljava/io/InputStream;)V
+
+    invoke-direct {v0, v1}, Ljava/io/BufferedReader;-><init>(Ljava/io/Reader;)V
+
+    iput-object v0, p0, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->buffReader:Ljava/io/BufferedReader;
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public close()V
+    .registers 2
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/IOException;
+        }
+    .end annotation
+
+    iget-object v0, p0, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->inputStream:Ljava/io/FileInputStream;
+
+    invoke-virtual {v0}, Ljava/io/FileInputStream;->close()V
+
+    return-void
+.end method
+
+.method public readLine()Ljava/lang/String;
+    .registers 2
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/IOException;
+        }
+    .end annotation
+
+    iget-object v0, p0, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->buffReader:Ljava/io/BufferedReader;
+
+    invoke-virtual {v0}, Ljava/io/BufferedReader;->readLine()Ljava/lang/String;
+
+    move-result-object v0
+
+    return-object v0
+.end method
diff -Npruw stock-core/smali/java/lang/PrivacyProcessManager.smali pdroid-core/smali/java/lang/PrivacyProcessManager.smali
--- stock-core/smali/java/lang/PrivacyProcessManager.smali	1969-12-31 18:00:00.000000000 -0600
+++ pdroid-core/smali/java/lang/PrivacyProcessManager.smali	2014-01-25 12:10:19.882070163 -0600
@@ -0,0 +1,482 @@
+.class public Ljava/lang/PrivacyProcessManager;
+.super Ljava/lang/Object;
+.source "PrivacyProcessManager.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Ljava/lang/PrivacyProcessManager$PrivacyFileReader;
+    }
+.end annotation
+
+
+# static fields
+.field private static final GET_COMMAND_WAIT_MS:I = 0xa
+
+.field private static final GET_COMMAND_WAIT_STEP:I = 0x5
+
+
+# direct methods
+.method public constructor <init>()V
+    .registers 1
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+.method private static getPackageName()Ljava/lang/String;
+    .registers 3
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/io/IOException;,
+            Ljava/io/FileNotFoundException;
+        }
+    .end annotation
+
+    new-instance v0, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;
+
+    const-string v2, "/proc/self/cmdline"
+
+    invoke-direct {v0, v2}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v0}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->readLine()Ljava/lang/String;
+
+    move-result-object v2
+
+    invoke-virtual {v2}, Ljava/lang/String;->trim()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-virtual {v0}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->close()V
+
+    return-object v1
+.end method
+
+.method public static hasPrivacyPermission(Ljava/lang/String;)Z
+    .registers 12
+    .param p0    # Ljava/lang/String;
+
+    const/4 v6, 0x0
+
+    const/4 v5, 0x1
+
+    :try_start_2
+    invoke-static {}, Ljava/lang/PrivacyProcessManager;->getPackageName()Ljava/lang/String;
+
+    move-result-object v6
+
+    sget-object v8, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    new-instance v9, Ljava/lang/StringBuilder;
+
+    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v10, "PrivacyProcessManager: got package name: "
+
+    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v9
+
+    invoke-virtual {v9, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v9
+
+    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v9
+
+    invoke-virtual {v8, v9}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+    :try_end_1e
+    .catch Ljava/lang/Exception; {:try_start_2 .. :try_end_1e} :catch_57
+
+    :goto_1e
+    const/4 v2, 0x0
+
+    :try_start_1f
+    new-instance v8, Ljava/lang/StringBuilder;
+
+    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v9, "/data/system/privacy/"
+
+    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v8
+
+    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v8
+
+    const-string v9, "/"
+
+    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v8
+
+    invoke-virtual {v8, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v8
+
+    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v7
+
+    new-instance v3, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;
+
+    invoke-direct {v3, v7}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;-><init>(Ljava/lang/String;)V
+    :try_end_41
+    .catch Ljava/io/FileNotFoundException; {:try_start_1f .. :try_end_41} :catch_85
+    .catch Ljava/lang/Exception; {:try_start_1f .. :try_end_41} :catch_65
+
+    :try_start_41
+    invoke-virtual {v3}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->readLine()Ljava/lang/String;
+
+    move-result-object v4
+
+    if-eqz v4, :cond_63
+
+    invoke-virtual {v4}, Ljava/lang/String;->trim()Ljava/lang/String;
+
+    move-result-object v8
+
+    invoke-static {v8}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+
+    move-result v0
+
+    :goto_4f
+    invoke-virtual {v3}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->close()V
+    :try_end_52
+    .catch Ljava/io/FileNotFoundException; {:try_start_41 .. :try_end_52} :catch_87
+    .catch Ljava/lang/Exception; {:try_start_41 .. :try_end_52} :catch_82
+
+    const/4 v8, 0x1
+
+    if-ne v0, v8, :cond_56
+
+    const/4 v5, 0x0
+
+    :cond_56
+    :goto_56
+    return v5
+
+    :catch_57
+    move-exception v1
+
+    sget-object v8, Ljava/lang/System;->err:Ljava/io/PrintStream;
+
+    const-string v9, "PrivacyProcessManager: could not find package name"
+
+    invoke-virtual {v8, v9}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    invoke-virtual {v1}, Ljava/lang/Exception;->printStackTrace()V
+
+    goto :goto_1e
+
+    :cond_63
+    const/4 v0, -0x1
+
+    goto :goto_4f
+
+    :catch_65
+    move-exception v1
+
+    :goto_66
+    sget-object v8, Ljava/lang/System;->err:Ljava/io/PrintStream;
+
+    new-instance v9, Ljava/lang/StringBuilder;
+
+    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v10, "PrivacyProcessManager: could not read privacy settings: "
+
+    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v9
+
+    invoke-virtual {v9, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v9
+
+    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v9
+
+    invoke-virtual {v8, v9}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    invoke-virtual {v1}, Ljava/lang/Exception;->printStackTrace()V
+
+    goto :goto_56
+
+    :catch_82
+    move-exception v1
+
+    move-object v2, v3
+
+    goto :goto_66
+
+    :catch_85
+    move-exception v8
+
+    goto :goto_56
+
+    :catch_87
+    move-exception v8
+
+    move-object v2, v3
+
+    goto :goto_56
+.end method
+
+.method public static hasPrivacyPermission(Ljava/lang/String;I)Z
+    .registers 16
+    .param p0    # Ljava/lang/String;
+    .param p1    # I
+
+    const/4 v7, 0x0
+
+    const/4 v6, 0x1
+
+    :try_start_2
+    invoke-static {}, Ljava/lang/PrivacyProcessManager;->getPackageName()Ljava/lang/String;
+    :try_end_5
+    .catch Ljava/lang/Exception; {:try_start_2 .. :try_end_5} :catch_39
+
+    move-result-object v7
+
+    :goto_6
+    const/4 v2, 0x0
+
+    :try_start_7
+    new-instance v11, Ljava/lang/StringBuilder;
+
+    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v12, "/proc/"
+
+    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v11
+
+    invoke-virtual {v11, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    move-result-object v11
+
+    const-string v12, "/cmdline"
+
+    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v11
+
+    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v0
+
+    new-instance v3, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;
+
+    invoke-direct {v3, v0}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;-><init>(Ljava/lang/String;)V
+    :try_end_25
+    .catch Ljava/io/FileNotFoundException; {:try_start_7 .. :try_end_25} :catch_b9
+    .catch Ljava/lang/Exception; {:try_start_7 .. :try_end_25} :catch_97
+
+    :try_start_25
+    const-string v8, ""
+
+    const/16 v4, 0xa
+
+    :goto_29
+    invoke-virtual {v3}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->readLine()Ljava/lang/String;
+    :try_end_2c
+    .catch Ljava/io/FileNotFoundException; {:try_start_25 .. :try_end_2c} :catch_bb
+    .catch Ljava/lang/Exception; {:try_start_25 .. :try_end_2c} :catch_b6
+
+    move-result-object v8
+
+    if-nez v8, :cond_45
+
+    if-ltz v4, :cond_45
+
+    const-wide/16 v11, 0x5
+
+    :try_start_33
+    invoke-static {v11, v12}, Ljava/lang/Thread;->sleep(J)V
+    :try_end_36
+    .catch Ljava/lang/InterruptedException; {:try_start_33 .. :try_end_36} :catch_b4
+    .catch Ljava/io/FileNotFoundException; {:try_start_33 .. :try_end_36} :catch_bb
+    .catch Ljava/lang/Exception; {:try_start_33 .. :try_end_36} :catch_b6
+
+    :goto_36
+    add-int/lit8 v4, v4, -0x5
+
+    goto :goto_29
+
+    :catch_39
+    move-exception v1
+
+    sget-object v11, Ljava/lang/System;->err:Ljava/io/PrintStream;
+
+    const-string v12, "PrivacyProcessManager: could not find package name or UID"
+
+    invoke-virtual {v11, v12}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    invoke-virtual {v1}, Ljava/lang/Exception;->printStackTrace()V
+
+    goto :goto_6
+
+    :cond_45
+    :try_start_45
+    invoke-virtual {v3}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->close()V
+
+    if-eqz v8, :cond_be
+
+    invoke-virtual {v8}, Ljava/lang/String;->trim()Ljava/lang/String;
+
+    move-result-object v11
+
+    invoke-virtual {v11}, Ljava/lang/String;->length()I
+
+    move-result v11
+
+    const/4 v12, 0x5
+
+    if-le v11, v12, :cond_be
+
+    const-string v11, "logcat"
+
+    invoke-virtual {v8, v11}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+
+    move-result v11
+
+    if-eqz v11, :cond_be
+
+    new-instance v11, Ljava/lang/StringBuilder;
+
+    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v12, "/data/system/privacy/"
+
+    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v11
+
+    invoke-virtual {v11, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v11
+
+    const-string v12, "/"
+
+    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v11
+
+    invoke-virtual {v11, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v11
+
+    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v9
+
+    new-instance v2, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;
+
+    invoke-direct {v2, v9}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;-><init>(Ljava/lang/String;)V
+    :try_end_7f
+    .catch Ljava/io/FileNotFoundException; {:try_start_45 .. :try_end_7f} :catch_bb
+    .catch Ljava/lang/Exception; {:try_start_45 .. :try_end_7f} :catch_b6
+
+    :try_start_7f
+    invoke-virtual {v2}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->readLine()Ljava/lang/String;
+
+    move-result-object v5
+
+    if-eqz v5, :cond_95
+
+    invoke-virtual {v5}, Ljava/lang/String;->trim()Ljava/lang/String;
+
+    move-result-object v11
+
+    invoke-static {v11}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+
+    move-result v10
+
+    :goto_8d
+    invoke-virtual {v2}, Ljava/lang/PrivacyProcessManager$PrivacyFileReader;->close()V
+    :try_end_90
+    .catch Ljava/io/FileNotFoundException; {:try_start_7f .. :try_end_90} :catch_b9
+    .catch Ljava/lang/Exception; {:try_start_7f .. :try_end_90} :catch_97
+
+    const/4 v11, 0x1
+
+    if-ne v10, v11, :cond_94
+
+    const/4 v6, 0x0
+
+    :cond_94
+    :goto_94
+    return v6
+
+    :cond_95
+    const/4 v10, -0x1
+
+    goto :goto_8d
+
+    :catch_97
+    move-exception v1
+
+    :goto_98
+    sget-object v11, Ljava/lang/System;->err:Ljava/io/PrintStream;
+
+    new-instance v12, Ljava/lang/StringBuilder;
+
+    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v13, "PrivacyProcessManager: could not read privacy settings: "
+
+    invoke-virtual {v12, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v12
+
+    invoke-virtual {v12, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v12
+
+    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v12
+
+    invoke-virtual {v11, v12}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    invoke-virtual {v1}, Ljava/lang/Exception;->printStackTrace()V
+
+    goto :goto_94
+
+    :catch_b4
+    move-exception v11
+
+    goto :goto_36
+
+    :catch_b6
+    move-exception v1
+
+    move-object v2, v3
+
+    goto :goto_98
+
+    :catch_b9
+    move-exception v11
+
+    goto :goto_94
+
+    :catch_bb
+    move-exception v11
+
+    move-object v2, v3
+
+    goto :goto_94
+
+    :cond_be
+    move-object v2, v3
+
+    goto :goto_94
+.end method
diff -Npruw stock-core/smali/java/lang/ProcessManager$ProcessImpl.smali pdroid-core/smali/java/lang/ProcessManager$ProcessImpl.smali
--- stock-core/smali/java/lang/ProcessManager$ProcessImpl.smali	2014-01-25 12:10:07.850069655 -0600
+++ pdroid-core/smali/java/lang/ProcessManager$ProcessImpl.smali	2014-01-25 12:10:19.878070163 -0600
@@ -21,6 +21,8 @@
 
 .field private final exitValueMutex:Ljava/lang/Object;
 
+.field private fakeProcess:Z
+
 .field private final inputStream:Ljava/io/InputStream;
 
 .field private final outputStream:Ljava/io/OutputStream;
@@ -40,6 +42,75 @@
 
     invoke-direct {p0}, Ljava/lang/Process;-><init>()V
 
+    const/4 v0, 0x0
+
+    iput-boolean v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->fakeProcess:Z
+
+    iput-object v1, p0, Ljava/lang/ProcessManager$ProcessImpl;->exitValue:Ljava/lang/Integer;
+
+    new-instance v0, Ljava/lang/Object;
+
+    invoke-direct {v0}, Ljava/lang/Object;-><init>()V
+
+    iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->exitValueMutex:Ljava/lang/Object;
+
+    iput p1, p0, Ljava/lang/ProcessManager$ProcessImpl;->pid:I
+
+    new-instance v0, Ljava/lang/ProcessManager$ProcessInputStream;
+
+    invoke-direct {v0, p4, v1}, Ljava/lang/ProcessManager$ProcessInputStream;-><init>(Ljava/io/FileDescriptor;Ljava/lang/ProcessManager$1;)V
+
+    iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->errorStream:Ljava/io/InputStream;
+
+    const-string v0, "systemLogsSetting"
+
+    invoke-static {v0, p1}, Ljava/lang/PrivacyProcessManager;->hasPrivacyPermission(Ljava/lang/String;I)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_30
+
+    new-instance v0, Ljava/lang/ProcessManager$ProcessInputStream;
+
+    invoke-direct {v0, p2, v1}, Ljava/lang/ProcessManager$ProcessInputStream;-><init>(Ljava/io/FileDescriptor;Ljava/lang/ProcessManager$1;)V
+
+    iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->inputStream:Ljava/io/InputStream;
+
+    :goto_28
+    new-instance v0, Ljava/lang/ProcessManager$ProcessOutputStream;
+
+    invoke-direct {v0, p3, v1}, Ljava/lang/ProcessManager$ProcessOutputStream;-><init>(Ljava/io/FileDescriptor;Ljava/lang/ProcessManager$1;)V
+
+    iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->outputStream:Ljava/io/OutputStream;
+
+    return-void
+
+    :cond_30
+    new-instance v0, Ljava/lang/PrivacyInputStream;
+
+    invoke-direct {v0}, Ljava/lang/PrivacyInputStream;-><init>()V
+
+    iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->inputStream:Ljava/io/InputStream;
+
+    goto :goto_28
+.end method
+
+.method constructor <init>(ILjava/io/FileDescriptor;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;Z)V
+    .registers 8
+    .param p1    # I
+    .param p2    # Ljava/io/FileDescriptor;
+    .param p3    # Ljava/io/FileDescriptor;
+    .param p4    # Ljava/io/FileDescriptor;
+    .param p5    # Z
+
+    const/4 v1, 0x0
+
+    invoke-direct {p0}, Ljava/lang/Process;-><init>()V
+
+    const/4 v0, 0x0
+
+    iput-boolean v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->fakeProcess:Z
+
     iput-object v1, p0, Ljava/lang/ProcessManager$ProcessImpl;->exitValue:Ljava/lang/Integer;
 
     new-instance v0, Ljava/lang/Object;
@@ -56,12 +127,15 @@
 
     iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->errorStream:Ljava/io/InputStream;
 
+    if-eqz p5, :cond_2a
+
     new-instance v0, Ljava/lang/ProcessManager$ProcessInputStream;
 
     invoke-direct {v0, p2, v1}, Ljava/lang/ProcessManager$ProcessInputStream;-><init>(Ljava/io/FileDescriptor;Ljava/lang/ProcessManager$1;)V
 
     iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->inputStream:Ljava/io/InputStream;
 
+    :goto_22
     new-instance v0, Ljava/lang/ProcessManager$ProcessOutputStream;
 
     invoke-direct {v0, p3, v1}, Ljava/lang/ProcessManager$ProcessOutputStream;-><init>(Ljava/io/FileDescriptor;Ljava/lang/ProcessManager$1;)V
@@ -69,6 +143,19 @@
     iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->outputStream:Ljava/io/OutputStream;
 
     return-void
+
+    :cond_2a
+    new-instance v0, Ljava/lang/PrivacyInputStream;
+
+    invoke-direct {v0}, Ljava/lang/PrivacyInputStream;-><init>()V
+
+    iput-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->inputStream:Ljava/io/InputStream;
+
+    const/4 v0, 0x1
+
+    iput-boolean v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->fakeProcess:Z
+
+    goto :goto_22
 .end method
 
 .method static synthetic access$300(Ljava/lang/ProcessManager$ProcessImpl;)I
@@ -91,12 +178,17 @@
 
     :try_start_3
     iget-object v1, p0, Ljava/lang/ProcessManager$ProcessImpl;->exitValue:Ljava/lang/Integer;
-    :try_end_5
-    .catchall {:try_start_3 .. :try_end_5} :catchall_3b
 
-    if-nez v1, :cond_10
+    if-eqz v1, :cond_b
 
-    :try_start_7
+    iget-boolean v1, p0, Ljava/lang/ProcessManager$ProcessImpl;->fakeProcess:Z
+    :try_end_9
+    .catchall {:try_start_3 .. :try_end_9} :catchall_3f
+
+    if-eqz v1, :cond_14
+
+    :cond_b
+    :try_start_b
     sget-object v1, Llibcore/io/Libcore;->os:Llibcore/io/Os;
 
     iget v3, p0, Ljava/lang/ProcessManager$ProcessImpl;->pid:I
@@ -104,16 +196,16 @@
     sget v4, Llibcore/io/OsConstants;->SIGKILL:I
 
     invoke-interface {v1, v3, v4}, Llibcore/io/Os;->kill(II)V
-    :try_end_10
-    .catch Llibcore/io/ErrnoException; {:try_start_7 .. :try_end_10} :catch_21
-    .catchall {:try_start_7 .. :try_end_10} :catchall_3b
-
-    :cond_10
-    :goto_10
-    :try_start_10
+    :try_end_14
+    .catch Llibcore/io/ErrnoException; {:try_start_b .. :try_end_14} :catch_25
+    .catchall {:try_start_b .. :try_end_14} :catchall_3f
+
+    :cond_14
+    :goto_14
+    :try_start_14
     monitor-exit v2
-    :try_end_11
-    .catchall {:try_start_10 .. :try_end_11} :catchall_3b
+    :try_end_15
+    .catchall {:try_start_14 .. :try_end_15} :catchall_3f
 
     iget-object v1, p0, Ljava/lang/ProcessManager$ProcessImpl;->inputStream:Ljava/io/InputStream;
 
@@ -129,10 +221,10 @@
 
     return-void
 
-    :catch_21
+    :catch_25
     move-exception v0
 
-    :try_start_22
+    :try_start_26
     new-instance v1, Ljava/lang/StringBuilder;
 
     invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V
@@ -155,14 +247,14 @@
 
     invoke-static {v1, v0}, Ljava/lang/System;->logI(Ljava/lang/String;Ljava/lang/Throwable;)V
 
-    goto :goto_10
+    goto :goto_14
 
-    :catchall_3b
+    :catchall_3f
     move-exception v1
 
     monitor-exit v2
-    :try_end_3d
-    .catchall {:try_start_22 .. :try_end_3d} :catchall_3b
+    :try_end_41
+    .catchall {:try_start_26 .. :try_end_41} :catchall_3f
 
     throw v1
 .end method
@@ -170,14 +262,23 @@
 .method public exitValue()I
     .registers 5
 
+    iget-boolean v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->fakeProcess:Z
+
+    if-eqz v0, :cond_8
+
+    const/4 v0, 0x0
+
+    invoke-virtual {p0, v0}, Ljava/lang/ProcessManager$ProcessImpl;->setExitValue(I)V
+
+    :cond_8
     iget-object v1, p0, Ljava/lang/ProcessManager$ProcessImpl;->exitValueMutex:Ljava/lang/Object;
 
     monitor-enter v1
 
-    :try_start_3
+    :try_start_b
     iget-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->exitValue:Ljava/lang/Integer;
 
-    if-nez v0, :cond_25
+    if-nez v0, :cond_2d
 
     new-instance v0, Ljava/lang/IllegalThreadStateException;
 
@@ -205,17 +306,17 @@
 
     throw v0
 
-    :catchall_22
+    :catchall_2a
     move-exception v0
 
     monitor-exit v1
-    :try_end_24
-    .catchall {:try_start_3 .. :try_end_24} :catchall_22
+    :try_end_2c
+    .catchall {:try_start_b .. :try_end_2c} :catchall_2a
 
     throw v0
 
-    :cond_25
-    :try_start_25
+    :cond_2d
+    :try_start_2d
     iget-object v0, p0, Ljava/lang/ProcessManager$ProcessImpl;->exitValue:Ljava/lang/Integer;
 
     invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I
@@ -223,8 +324,8 @@
     move-result v0
 
     monitor-exit v1
-    :try_end_2c
-    .catchall {:try_start_25 .. :try_end_2c} :catchall_22
+    :try_end_34
+    .catchall {:try_start_2d .. :try_end_34} :catchall_2a
 
     return v0
 .end method
diff -Npruw stock-core/smali/java/lang/ProcessManager.smali pdroid-core/smali/java/lang/ProcessManager.smali
--- stock-core/smali/java/lang/ProcessManager.smali	2014-01-25 12:10:07.854069655 -0600
+++ pdroid-core/smali/java/lang/ProcessManager.smali	2014-01-25 12:10:19.886070163 -0600
@@ -137,6 +137,156 @@
     return-void
 .end method
 
+.method private containsIpTableCommand(Ljava/lang/String;)Z
+    .registers 10
+    .param p1    # Ljava/lang/String;
+
+    const/4 v5, 0x0
+
+    :try_start_1
+    sget-object v6, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    const-string v7, "now we\'re in containsIpTableCommand"
+
+    invoke-virtual {v6, v7}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    new-instance v3, Ljava/io/FileInputStream;
+
+    invoke-direct {v3, p1}, Ljava/io/FileInputStream;-><init>(Ljava/lang/String;)V
+
+    new-instance v1, Ljava/io/DataInputStream;
+
+    invoke-direct {v1, v3}, Ljava/io/DataInputStream;-><init>(Ljava/io/InputStream;)V
+
+    new-instance v0, Ljava/io/BufferedReader;
+
+    new-instance v6, Ljava/io/InputStreamReader;
+
+    invoke-direct {v6, v1}, Ljava/io/InputStreamReader;-><init>(Ljava/io/InputStream;)V
+
+    invoke-direct {v0, v6}, Ljava/io/BufferedReader;-><init>(Ljava/io/Reader;)V
+
+    :cond_1c
+    invoke-virtual {v0}, Ljava/io/BufferedReader;->readLine()Ljava/lang/String;
+
+    move-result-object v4
+
+    if-eqz v4, :cond_6a
+
+    const-string v6, "iptables"
+
+    invoke-virtual {v4, v6}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+
+    move-result v6
+
+    if-nez v6, :cond_32
+
+    const-string v6, "ip6tables"
+
+    invoke-virtual {v4, v6}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+    :try_end_2f
+    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_2f} :catch_59
+
+    move-result v6
+
+    if-eqz v6, :cond_1c
+
+    :cond_32
+    :try_start_32
+    invoke-virtual {v1}, Ljava/io/DataInputStream;->close()V
+
+    invoke-virtual {v0}, Ljava/io/BufferedReader;->close()V
+
+    invoke-virtual {v3}, Ljava/io/FileInputStream;->close()V
+    :try_end_3b
+    .catch Ljava/io/IOException; {:try_start_32 .. :try_end_3b} :catch_4a
+    .catchall {:try_start_32 .. :try_end_3b} :catchall_62
+
+    const/4 v3, 0x0
+
+    const/4 v1, 0x0
+
+    const/4 v0, 0x0
+
+    :try_start_3e
+    invoke-static {}, Ljava/lang/System;->gc()V
+
+    :goto_41
+    sget-object v6, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    const-string v7, "returning true, file contains iptable command"
+
+    invoke-virtual {v6, v7}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+    :try_end_48
+    .catch Ljava/lang/Exception; {:try_start_3e .. :try_end_48} :catch_59
+
+    const/4 v5, 0x1
+
+    :goto_49
+    return v5
+
+    :catch_4a
+    move-exception v2
+
+    :try_start_4b
+    sget-object v6, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    const-string v7, "got exception while closing streams"
+
+    invoke-virtual {v6, v7}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+    :try_end_52
+    .catchall {:try_start_4b .. :try_end_52} :catchall_62
+
+    const/4 v3, 0x0
+
+    const/4 v1, 0x0
+
+    const/4 v0, 0x0
+
+    :try_start_55
+    invoke-static {}, Ljava/lang/System;->gc()V
+    :try_end_58
+    .catch Ljava/lang/Exception; {:try_start_55 .. :try_end_58} :catch_59
+
+    goto :goto_41
+
+    :catch_59
+    move-exception v2
+
+    sget-object v6, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    const-string v7, "returning false,because we got exception while parsing"
+
+    invoke-virtual {v6, v7}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    goto :goto_49
+
+    :catchall_62
+    move-exception v6
+
+    const/4 v3, 0x0
+
+    const/4 v1, 0x0
+
+    const/4 v0, 0x0
+
+    :try_start_66
+    invoke-static {}, Ljava/lang/System;->gc()V
+
+    throw v6
+
+    :cond_6a
+    sget-object v6, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    const-string v7, "returning false, file doesn\'t contains iptable command"
+
+    invoke-virtual {v6, v7}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+    :try_end_71
+    .catch Ljava/lang/Exception; {:try_start_66 .. :try_end_71} :catch_59
+
+    goto :goto_49
+.end method
+
 .method private static native exec([Ljava/lang/String;[Ljava/lang/String;Ljava/lang/String;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;Z)I
     .annotation system Ldalvik/annotation/Throws;
         value = {
@@ -396,7 +546,7 @@
 
 # virtual methods
 .method public exec([Ljava/lang/String;[Ljava/lang/String;Ljava/io/File;Z)Ljava/lang/Process;
-    .registers 21
+    .registers 24
     .param p1    # [Ljava/lang/String;
     .param p2    # [Ljava/lang/String;
     .param p3    # Ljava/io/File;
@@ -407,150 +557,411 @@
         }
     .end annotation
 
-    if-nez p1, :cond_a
+    const/4 v15, 0x1
+
+    if-eqz p1, :cond_30
+
+    const/4 v14, 0x0
+
+    :goto_4
+    move-object/from16 v0, p1
+
+    array-length v9, v0
+
+    if-ge v14, v9, :cond_30
+
+    sget-object v9, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    new-instance v10, Ljava/lang/StringBuilder;
+
+    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v11, "tainted command part "
+
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v10
+
+    invoke-virtual {v10, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    move-result-object v10
+
+    const-string v11, ": "
+
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    new-instance v7, Ljava/lang/NullPointerException;
+    move-result-object v10
 
-    const-string v14, "taintedCommand == null"
+    aget-object v11, p1, v14
 
-    invoke-direct {v7, v14}, Ljava/lang/NullPointerException;-><init>(Ljava/lang/String;)V
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    throw v7
+    move-result-object v10
+
+    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v10
+
+    invoke-virtual {v9, v10}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    add-int/lit8 v14, v14, 0x1
+
+    goto :goto_4
+
+    :cond_30
+    if-eqz p1, :cond_aa
 
-    :cond_a
     move-object/from16 v0, p1
 
-    array-length v7, v0
+    array-length v9, v0
+
+    if-lez v9, :cond_aa
 
-    if-nez v7, :cond_17
+    const/4 v9, 0x0
+
+    aget-object v9, p1, v9
+
+    const-string v10, "su"
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
-    new-instance v7, Ljava/lang/IndexOutOfBoundsException;
+    move-result v9
+
+    if-nez v9, :cond_63
+
+    const/4 v9, 0x0
 
-    const-string v14, "taintedCommand.length == 0"
+    aget-object v9, p1, v9
+
+    const-string v10, "sh"
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v9
+
+    if-nez v9, :cond_63
+
+    const/4 v9, 0x0
+
+    aget-object v9, p1, v9
+
+    const-string v10, "bash"
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v9
+
+    if-nez v9, :cond_63
+
+    const/4 v9, 0x0
 
-    invoke-direct {v7, v14}, Ljava/lang/IndexOutOfBoundsException;-><init>(Ljava/lang/String;)V
+    aget-object v9, p1, v9
 
-    throw v7
+    const-string v10, "rbash"
 
-    :cond_17
+    invoke-virtual {v9, v10}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v9
+
+    if-eqz v9, :cond_aa
+
+    :cond_63
+    const/4 v14, 0x0
+
+    :goto_64
+    move-object/from16 v0, p1
+
+    array-length v9, v0
+
+    if-ge v14, v9, :cond_aa
+
+    sget-object v9, Ljava/lang/System;->out:Ljava/io/PrintStream;
+
+    new-instance v10, Ljava/lang/StringBuilder;
+
+    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v11, "Now test tainted command: "
+
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v10
+
+    aget-object v11, p1, v14
+
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v10
+
+    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v10
+
+    invoke-virtual {v9, v10}, Ljava/io/PrintStream;->println(Ljava/lang/String;)V
+
+    aget-object v9, p1, v14
+
+    const-string v10, ".sh"
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+
+    move-result v9
+
+    if-nez v9, :cond_97
+
+    aget-object v9, p1, v14
+
+    const-string v10, "/"
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+
+    move-result v9
+
+    if-eqz v9, :cond_eb
+
+    :cond_97
+    aget-object v9, p1, v14
+
+    move-object/from16 v0, p0
+
+    invoke-direct {v0, v9}, Ljava/lang/ProcessManager;->containsIpTableCommand(Ljava/lang/String;)Z
+
+    move-result v9
+
+    if-eqz v9, :cond_eb
+
+    const-string v9, "ipTableProtectSetting"
+
+    invoke-static {v9}, Ljava/lang/PrivacyProcessManager;->hasPrivacyPermission(Ljava/lang/String;)Z
+
+    move-result v9
+
+    if-nez v9, :cond_eb
+
+    const/4 v15, 0x0
+
+    :cond_aa
+    if-eqz p1, :cond_d5
+
+    move-object/from16 v0, p1
+
+    array-length v9, v0
+
+    if-lez v9, :cond_d5
+
+    if-eqz v15, :cond_d5
+
+    const/4 v14, 0x0
+
+    :goto_b4
+    move-object/from16 v0, p1
+
+    array-length v9, v0
+
+    if-ge v14, v9, :cond_d5
+
+    aget-object v9, p1, v14
+
+    const-string v10, "iptables"
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+
+    move-result v9
+
+    if-nez v9, :cond_cd
+
+    aget-object v9, p1, v14
+
+    const-string v10, "ip6tables"
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z
+
+    move-result v9
+
+    if-eqz v9, :cond_f0
+
+    :cond_cd
+    const-string v9, "ipTableProtectSetting"
+
+    invoke-static {v9}, Ljava/lang/PrivacyProcessManager;->hasPrivacyPermission(Ljava/lang/String;)Z
+
+    move-result v9
+
+    if-eqz v9, :cond_ef
+
+    :cond_d5
+    if-nez v15, :cond_e1
+
+    const/4 v9, 0x1
+
+    new-array v0, v9, [Ljava/lang/String;
+
+    move-object/from16 p1, v0
+
+    const/4 v9, 0x0
+
+    const-string v10, "su"
+
+    aput-object v10, p1, v9
+
+    :cond_e1
+    if-nez p1, :cond_f3
+
+    new-instance v9, Ljava/lang/NullPointerException;
+
+    const-string v10, "taintedCommand == null"
+
+    invoke-direct {v9, v10}, Ljava/lang/NullPointerException;-><init>(Ljava/lang/String;)V
+
+    throw v9
+
+    :cond_eb
+    add-int/lit8 v14, v14, 0x1
+
+    goto/16 :goto_64
+
+    :cond_ef
+    const/4 v15, 0x0
+
+    :cond_f0
+    add-int/lit8 v14, v14, 0x1
+
+    goto :goto_b4
+
+    :cond_f3
+    move-object/from16 v0, p1
+
+    array-length v9, v0
+
+    if-nez v9, :cond_100
+
+    new-instance v9, Ljava/lang/IndexOutOfBoundsException;
+
+    const-string v10, "taintedCommand.length == 0"
+
+    invoke-direct {v9, v10}, Ljava/lang/IndexOutOfBoundsException;-><init>(Ljava/lang/String;)V
+
+    throw v9
+
+    :cond_100
     invoke-virtual/range {p1 .. p1}, [Ljava/lang/String;->clone()Ljava/lang/Object;
 
     move-result-object v1
 
     check-cast v1, [Ljava/lang/String;
 
-    if-eqz p2, :cond_4d
+    if-eqz p2, :cond_136
 
     invoke-virtual/range {p2 .. p2}, [Ljava/lang/String;->clone()Ljava/lang/Object;
 
-    move-result-object v7
+    move-result-object v9
 
-    check-cast v7, [Ljava/lang/String;
+    check-cast v9, [Ljava/lang/String;
 
-    move-object v2, v7
+    move-object v2, v9
 
-    :goto_26
-    const/4 v9, 0x0
+    :goto_10f
+    const/4 v14, 0x0
 
-    :goto_27
-    array-length v7, v1
+    :goto_110
+    array-length v9, v1
 
-    if-ge v9, v7, :cond_52
+    if-ge v14, v9, :cond_13b
 
-    aget-object v7, v1, v9
+    aget-object v9, v1, v14
 
-    if-nez v7, :cond_4f
+    if-nez v9, :cond_138
 
-    new-instance v7, Ljava/lang/NullPointerException;
+    new-instance v9, Ljava/lang/NullPointerException;
 
-    new-instance v14, Ljava/lang/StringBuilder;
+    new-instance v10, Ljava/lang/StringBuilder;
 
-    invoke-direct {v14}, Ljava/lang/StringBuilder;-><init>()V
+    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V
 
-    const-string v15, "taintedCommand["
+    const-string v11, "taintedCommand["
 
-    invoke-virtual {v14, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v14
+    move-result-object v10
 
-    invoke-virtual {v14, v9}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+    invoke-virtual {v10, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    move-result-object v14
+    move-result-object v10
 
-    const-string v15, "] == null"
+    const-string v11, "] == null"
 
-    invoke-virtual {v14, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v14
+    move-result-object v10
 
-    invoke-virtual {v14}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    move-result-object v14
+    move-result-object v10
 
-    invoke-direct {v7, v14}, Ljava/lang/NullPointerException;-><init>(Ljava/lang/String;)V
+    invoke-direct {v9, v10}, Ljava/lang/NullPointerException;-><init>(Ljava/lang/String;)V
 
-    throw v7
+    throw v9
 
-    :cond_4d
+    :cond_136
     const/4 v2, 0x0
 
-    goto :goto_26
+    goto :goto_10f
 
-    :cond_4f
-    add-int/lit8 v9, v9, 0x1
+    :cond_138
+    add-int/lit8 v14, v14, 0x1
 
-    goto :goto_27
+    goto :goto_110
 
-    :cond_52
-    if-eqz v2, :cond_7e
+    :cond_13b
+    if-eqz v2, :cond_167
 
-    const/4 v9, 0x0
+    const/4 v14, 0x0
 
-    :goto_55
-    array-length v7, v2
+    :goto_13e
+    array-length v9, v2
 
-    if-ge v9, v7, :cond_7e
+    if-ge v14, v9, :cond_167
 
-    aget-object v7, v2, v9
+    aget-object v9, v2, v14
 
-    if-nez v7, :cond_7b
+    if-nez v9, :cond_164
 
-    new-instance v7, Ljava/lang/NullPointerException;
+    new-instance v9, Ljava/lang/NullPointerException;
 
-    new-instance v14, Ljava/lang/StringBuilder;
+    new-instance v10, Ljava/lang/StringBuilder;
 
-    invoke-direct {v14}, Ljava/lang/StringBuilder;-><init>()V
+    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V
 
-    const-string v15, "taintedEnvironment["
+    const-string v11, "taintedEnvironment["
 
-    invoke-virtual {v14, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v14
+    move-result-object v10
 
-    invoke-virtual {v14, v9}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+    invoke-virtual {v10, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    move-result-object v14
+    move-result-object v10
 
-    const-string v15, "] == null"
+    const-string v11, "] == null"
 
-    invoke-virtual {v14, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v14
+    move-result-object v10
 
-    invoke-virtual {v14}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    move-result-object v14
+    move-result-object v10
 
-    invoke-direct {v7, v14}, Ljava/lang/NullPointerException;-><init>(Ljava/lang/String;)V
+    invoke-direct {v9, v10}, Ljava/lang/NullPointerException;-><init>(Ljava/lang/String;)V
 
-    throw v7
+    throw v9
 
-    :cond_7b
-    add-int/lit8 v9, v9, 0x1
+    :cond_164
+    add-int/lit8 v14, v14, 0x1
 
-    goto :goto_55
+    goto :goto_13e
 
-    :cond_7e
+    :cond_167
     new-instance v4, Ljava/io/FileDescriptor;
 
     invoke-direct {v4}, Ljava/io/FileDescriptor;-><init>()V
@@ -563,135 +974,166 @@
 
     invoke-direct {v6}, Ljava/io/FileDescriptor;-><init>()V
 
-    if-nez p3, :cond_bd
+    if-nez p3, :cond_1ae
 
     const/4 v3, 0x0
 
-    :goto_90
+    :goto_179
     move-object/from16 v0, p0
 
-    iget-object v14, v0, Ljava/lang/ProcessManager;->processReferences:Ljava/util/Map;
+    iget-object v0, v0, Ljava/lang/ProcessManager;->processReferences:Ljava/util/Map;
 
-    monitor-enter v14
+    move-object/from16 v18, v0
+
+    monitor-enter v18
 
     move/from16 v7, p4
 
-    :try_start_97
+    :try_start_182
     invoke-static/range {v1 .. v7}, Ljava/lang/ProcessManager;->exec([Ljava/lang/String;[Ljava/lang/String;Ljava/lang/String;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;Z)I
-    :try_end_9a
-    .catch Ljava/io/IOException; {:try_start_97 .. :try_end_9a} :catch_c2
-    .catchall {:try_start_97 .. :try_end_9a} :catchall_fd
+    :try_end_185
+    .catch Ljava/io/IOException; {:try_start_182 .. :try_end_185} :catch_1b3
+    .catchall {:try_start_182 .. :try_end_185} :catchall_1f2
+
+    move-result v8
 
-    move-result v10
+    if-eqz v15, :cond_1f5
 
-    :try_start_9b
-    new-instance v11, Ljava/lang/ProcessManager$ProcessImpl;
+    :try_start_188
+    new-instance v7, Ljava/lang/ProcessManager$ProcessImpl;
 
-    invoke-direct {v11, v10, v4, v5, v6}, Ljava/lang/ProcessManager$ProcessImpl;-><init>(ILjava/io/FileDescriptor;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;)V
+    invoke-direct {v7, v8, v4, v5, v6}, Ljava/lang/ProcessManager$ProcessImpl;-><init>(ILjava/io/FileDescriptor;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;)V
 
-    new-instance v12, Ljava/lang/ProcessManager$ProcessReference;
+    :goto_18d
+    new-instance v16, Ljava/lang/ProcessManager$ProcessReference;
 
     move-object/from16 v0, p0
 
-    iget-object v7, v0, Ljava/lang/ProcessManager;->referenceQueue:Ljava/lang/ProcessManager$ProcessReferenceQueue;
+    iget-object v9, v0, Ljava/lang/ProcessManager;->referenceQueue:Ljava/lang/ProcessManager$ProcessReferenceQueue;
 
-    invoke-direct {v12, v11, v7}, Ljava/lang/ProcessManager$ProcessReference;-><init>(Ljava/lang/ProcessManager$ProcessImpl;Ljava/lang/ProcessManager$ProcessReferenceQueue;)V
+    move-object/from16 v0, v16
+
+    invoke-direct {v0, v7, v9}, Ljava/lang/ProcessManager$ProcessReference;-><init>(Ljava/lang/ProcessManager$ProcessImpl;Ljava/lang/ProcessManager$ProcessReferenceQueue;)V
 
     move-object/from16 v0, p0
 
-    iget-object v7, v0, Ljava/lang/ProcessManager;->processReferences:Ljava/util/Map;
+    iget-object v9, v0, Ljava/lang/ProcessManager;->processReferences:Ljava/util/Map;
+
+    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;
 
-    invoke-static {v10}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;
+    move-result-object v10
 
-    move-result-object v15
+    move-object/from16 v0, v16
 
-    invoke-interface {v7, v15, v12}, Ljava/util/Map;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
+    invoke-interface {v9, v10, v0}, Ljava/util/Map;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
 
     move-object/from16 v0, p0
 
-    iget-object v7, v0, Ljava/lang/ProcessManager;->processReferences:Ljava/util/Map;
+    iget-object v9, v0, Ljava/lang/ProcessManager;->processReferences:Ljava/util/Map;
 
-    invoke-virtual {v7}, Ljava/lang/Object;->notifyAll()V
+    invoke-virtual {v9}, Ljava/lang/Object;->notifyAll()V
 
-    monitor-exit v14
-    :try_end_bc
-    .catchall {:try_start_9b .. :try_end_bc} :catchall_fd
+    monitor-exit v18
+    :try_end_1ad
+    .catchall {:try_start_188 .. :try_end_1ad} :catchall_1f2
 
-    return-object v11
+    return-object v7
 
-    :cond_bd
+    :cond_1ae
     invoke-virtual/range {p3 .. p3}, Ljava/io/File;->getPath()Ljava/lang/String;
 
     move-result-object v3
 
-    goto :goto_90
+    goto :goto_179
 
-    :catch_c2
-    move-exception v8
+    :catch_1b3
+    move-exception v13
 
-    :try_start_c3
-    new-instance v13, Ljava/io/IOException;
+    :try_start_1b4
+    new-instance v17, Ljava/io/IOException;
 
-    new-instance v7, Ljava/lang/StringBuilder;
+    new-instance v9, Ljava/lang/StringBuilder;
 
-    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V
+    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V
 
-    const-string v15, "Error running exec(). Command: "
+    const-string v10, "Error running exec(). Command: "
 
-    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v7
+    move-result-object v9
 
     invoke-static {v1}, Ljava/util/Arrays;->toString([Ljava/lang/Object;)Ljava/lang/String;
 
-    move-result-object v15
+    move-result-object v10
 
-    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v7
+    move-result-object v9
 
-    const-string v15, " Working Directory: "
+    const-string v10, " Working Directory: "
 
-    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v7
+    move-result-object v9
 
     move-object/from16 v0, p3
 
-    invoke-virtual {v7, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+    invoke-virtual {v9, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
 
-    move-result-object v7
+    move-result-object v9
 
-    const-string v15, " Environment: "
+    const-string v10, " Environment: "
 
-    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v7
+    move-result-object v9
 
     invoke-static {v2}, Ljava/util/Arrays;->toString([Ljava/lang/Object;)Ljava/lang/String;
 
-    move-result-object v15
+    move-result-object v10
+
+    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v9
+
+    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v9
+
+    move-object/from16 v0, v17
+
+    invoke-direct {v0, v9}, Ljava/io/IOException;-><init>(Ljava/lang/String;)V
+
+    move-object/from16 v0, v17
+
+    invoke-virtual {v0, v13}, Ljava/io/IOException;->initCause(Ljava/lang/Throwable;)Ljava/lang/Throwable;
+
+    throw v17
 
-    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    :catchall_1f2
+    move-exception v9
 
-    move-result-object v7
+    monitor-exit v18
+    :try_end_1f4
+    .catchall {:try_start_1b4 .. :try_end_1f4} :catchall_1f2
 
-    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    throw v9
 
-    move-result-object v7
+    :cond_1f5
+    :try_start_1f5
+    new-instance v7, Ljava/lang/ProcessManager$ProcessImpl;
 
-    invoke-direct {v13, v7}, Ljava/io/IOException;-><init>(Ljava/lang/String;)V
+    const/4 v12, 0x0
 
-    invoke-virtual {v13, v8}, Ljava/io/IOException;->initCause(Ljava/lang/Throwable;)Ljava/lang/Throwable;
+    move-object v9, v4
 
-    throw v13
+    move-object v10, v5
 
-    :catchall_fd
-    move-exception v7
+    move-object v11, v6
 
-    monitor-exit v14
-    :try_end_ff
-    .catchall {:try_start_c3 .. :try_end_ff} :catchall_fd
+    invoke-direct/range {v7 .. v12}, Ljava/lang/ProcessManager$ProcessImpl;-><init>(ILjava/io/FileDescriptor;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;Z)V
+    :try_end_1fe
+    .catchall {:try_start_1f5 .. :try_end_1fe} :catchall_1f2
 
-    throw v7
+    goto :goto_18d
 .end method
